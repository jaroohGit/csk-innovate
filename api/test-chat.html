<!DOCTYPE html>
<html>
<head>
    <title>Test Chat API</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #0a0a0a; color: #fff; }
        #messages { border: 1px solid #333; padding: 10px; margin: 20px 0; min-height: 200px; background: #111; }
        input { padding: 10px; width: 300px; }
        button { padding: 10px 20px; background: #ff5744; color: white; border: none; cursor: pointer; }
        .message { margin: 10px 0; padding: 5px; }
        .user { color: #4ade80; }
        .bot { color: #60a5fa; }
    </style>
</head>
<body>
    <h1>ðŸ¤– Test Chat API</h1>
    
    <div id="status"></div>
    
    <div id="messages"></div>
    
    <input type="text" id="messageInput" placeholder="à¸žà¸´à¸¡à¸žà¹Œà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡..." />
    <button onclick="sendMessage()">à¸ªà¹ˆà¸‡</button>
    
    <script>
        const messagesDiv = document.getElementById('messages');
        const statusDiv = document.getElementById('status');
        const input = document.getElementById('messageInput');
        
        // Test health endpoint
        fetch('/api/health')
            .then(r => r.json())
            .then(data => {
                statusDiv.innerHTML = `<div style="color: #4ade80;">âœ“ API Connected: ${JSON.stringify(data)}</div>`;
            })
            .catch(err => {
                statusDiv.innerHTML = `<div style="color: #ef4444;">âœ— API Error: ${err.message}</div>`;
            });
        
        async function sendMessage() {
            const message = input.value.trim();
            if (!message) return;
            
            // Show user message
            messagesDiv.innerHTML += `<div class="message user">You: ${message}</div>`;
            input.value = '';
            
            // Show bot typing
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot';
            typingDiv.innerHTML = 'Bot: typing...';
            messagesDiv.appendChild(typingDiv);
            
            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: message, history: [] })
                });
                
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let botText = '';
                
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    
                    const chunk = decoder.decode(value);
                    const lines = chunk.split('\n');
                    
                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            const data = JSON.parse(line.slice(6));
                            if (data.text) {
                                botText += data.text;
                                typingDiv.innerHTML = `Bot: ${botText}`;
                            }
                        }
                    }
                }
            } catch (err) {
                typingDiv.innerHTML = `Bot: Error - ${err.message}`;
                typingDiv.style.color = '#ef4444';
            }
        }
        
        input.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });
    </script>
</body>
</html>
